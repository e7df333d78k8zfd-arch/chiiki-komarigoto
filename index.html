<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åœ°åŸŸã®å›°ã‚Šã”ã¨æŠ•ç¨¿</title>
</head>
<body>

<h2>åœ°åŸŸã®å›°ã‚Šã”ã¨æŠ•ç¨¿</h2>

<input id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«"><br><br>
<input id="location" placeholder="åœ°åŸŸãƒ»å ´æ‰€"><br><br>

<select id="category">
  <option value="é«˜é½¢è€…">é«˜é½¢è€…</option>
  <option value="å­è‚²ã¦">å­è‚²ã¦</option>
</select><br><br>

<textarea id="content" placeholder="å†…å®¹"></textarea><br><br>

<button id="submitBtn">æŠ•ç¨¿</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCuA1iGo0nHN7w4tuv6LaQ34I41Yp0EXbE",
  authDomain: "chiiki-komarigoto.firebaseapp.com",
  projectId: "chiiki-komarigoto",
  storageBucket: "chiiki-komarigoto.firebasestorage.app",
  messagingSenderId: "278691153990",
  appId: "1:278691153990:web:3dbc7a67c2959a9a726247"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.getElementById("submitBtn").onclick = async () => {

  const titleEl = document.getElementById("title");
  const locationEl = document.getElementById("location");
  const categoryEl = document.getElementById("category");
  const contentEl = document.getElementById("content");

  // ğŸ”’ undefinedå®Œå…¨é˜²æ­¢
  const title = titleEl ? titleEl.value : "";
  const location = locationEl ? locationEl.value : "";
  const category = categoryEl ? categoryEl.value : "";
  const content = contentEl ? contentEl.value : "";

  console.log({ title, location, category, content });

  if (!title || !location || !content) {
    alert("æœªå…¥åŠ›ãŒã‚ã‚Šã¾ã™");
    return;
  }

  try {
    await addDoc(collection(db, "issues"), {
      title: String(title),
      location: String(location),
      category: String(category),
      content: String(content),
      createdAt: serverTimestamp()
    });

    alert("æŠ•ç¨¿æˆåŠŸï¼");
  } catch (e) {
    alert("Firestoreã‚¨ãƒ©ãƒ¼: " + e.message);
  }
};
</script>

</body>
</html>
