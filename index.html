<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>åœ°åŸŸå›°ã‚Šã”ã¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: sans-serif;
  margin: 10px;
}
.issue {
  border: 1px solid #ccc;
  padding: 8px;
  margin-bottom: 8px;
  border-radius: 6px;
}
.status {
  font-size: 12px;
  color: #666;
}
</style>
</head>
<body>

<h2>åœ°åŸŸã®å›°ã‚Šã”ã¨æŠ•ç¨¿</h2>

<input id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«"><br><br>

<select id="category">
  <option>é«˜é½¢è€…</option>
  <option>å­ã©ã‚‚</option>
  <option>ã‚´ãƒŸ</option>
  <option>é˜²çŠ¯</option>
  <option>äº¤é€š</option>
  <option>ãã®ä»–</option>
</select><br><br>

<textarea id="content" rows="4" placeholder="å†…å®¹"></textarea><br><br>

<input id="location" placeholder="å ´æ‰€ï¼ˆã€‡ä¸ç›®ã¾ã§ï¼‰"><br><br>

<button id="postBtn">æŠ•ç¨¿</button>

<hr>

<h2>ä¸€è¦§</h2>
<div id="list"></div>

<!-- Firebaseï¼ˆCDNç‰ˆï¼‰ -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  query,
  orderBy,
  onSnapshot,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ğŸ”½ ã‚ãªãŸãŒè²¼ã£ã¦ãã‚ŒãŸSDKï¼ˆãã®ã¾ã¾ä½¿ç”¨ï¼‰
const firebaseConfig = {
  apiKey: "AIzaSyCuA1iGo0nHN7w4tuv6LaQ34I41Yp0EXbE",
  authDomain: "chiiki-komarigoto.firebaseapp.com",
  projectId: "chiiki-komarigoto",
  storageBucket: "chiiki-komarigoto.firebasestorage.app",
  messagingSenderId: "278691153990",
  appId: "1:278691153990:web:3dbc7a67c2959a9a726247"
};

// Firebase åˆæœŸåŒ–
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// æŠ•ç¨¿å‡¦ç†
document.getElementById("postBtn").addEventListener("click", async () => {
  try {
    await addDoc(collection(db, "issues"), {
      title: title.value,
      category: category.value,
      content: content.value,
      location: location.value,
      status: "æœªå¯¾å¿œ",
      createdAt: serverTimestamp()
    });
    title.value = "";
    content.value = "";
    location.value = "";
    alert("æŠ•ç¨¿ã—ã¾ã—ãŸ");
  } catch (e) {
    alert("ã‚¨ãƒ©ãƒ¼ï¼š" + e.message);
  }
});

// ä¸€è¦§è¡¨ç¤ºï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
const q = query(
  collection(db, "issues"),
  orderBy("createdAt", "desc")
);

onSnapshot(q, (snapshot) => {
  const list = document.getElementById("list");
  list.innerHTML = "";
  snapshot.forEach(doc => {
    const d = doc.data();
    list.innerHTML += `
      <div class="issue">
        <strong>${d.title}</strong><br>
        ã€${d.category}ã€‘ ${d.location}<br>
        ${d.content}<br>
        <div class="status">çŠ¶æ…‹ï¼š${d.status}</div>
      </div>
    `;
  });
});
</script>

</body>
</html>
